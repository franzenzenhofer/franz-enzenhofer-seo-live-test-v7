const t=s=>`logs:${s}`,p=0,h=s=>Number.isInteger(s)&&Number(s)>0,n=s=>{if(!h(s))throw new Error(`[logs] Invalid tabId: ${s}`)},o=()=>{var s;return typeof chrome<"u"&&!!((s=chrome==null?void 0:chrome.storage)!=null&&s.session)},i=()=>{if(!o())throw new Error("[logs] chrome.storage.session is unavailable in this context");return chrome.storage.session};const g=async s=>{const r=i(),{[t(s)]:e}=await r.get(t(s));return Array.isArray(e)?e:[]},l=async(s,r)=>{const e=await g(s),w=i(),c=[...e,r],S=c.length>3e3?c.slice(-3e3):c;await w.set({[t(s)]:S})},y=async s=>{await i().remove(t(s))},u=async s=>(n(s),g(s)),E=async()=>g(0),f=async(s,r)=>{n(s),await l(s,r)},A=async s=>l(0,s),_=async s=>{n(s),await y(s)},T=async()=>y(0),L=()=>{var s;return typeof chrome<"u"&&!!((s=chrome==null?void 0:chrome.runtime)!=null&&s.sendMessage)},M=s=>typeof s=="object"&&s!==null&&"error"in s,a=async(s,r)=>{if(!L())throw new Error("[logs] chrome.runtime.sendMessage is unavailable");const e=await chrome.runtime.sendMessage({type:s,tabId:r});if(M(e))throw new Error(e.error);if(!e||typeof e!="object")throw new Error("[logs] Invalid response from background");return e},m=(s,r)=>`[${new Date().toISOString()}] tab=${s} ${r}`,D=async(s,r)=>{await f(s,m(String(s),r))},v=async s=>{await A(m("system",s))},B=async s=>{if(s===0){if(o())return E();const{logs:e}=await a("logs:get",0);return Array.isArray(e)?e:[]}if(n(s),o())return u(s);const{logs:r}=await a("logs:get",s);return Array.isArray(r)?r:[]},R=async s=>{if(s===0){if(o())return T();await a("logs:clear",0);return}if(n(s),o())return _(s);await a("logs:clear",s)},Y=async()=>{if(!o())throw new Error("[logs] chrome.storage.session is unavailable in this context");const s=await chrome.storage.session.get(null);return Object.entries(s).filter(([e])=>e.startsWith("logs:")).flatMap(([,e])=>Array.isArray(e)?e:[]).sort()},d=async()=>{if(!o())throw new Error("[logs] chrome.storage.session is unavailable in this context");const s=await chrome.storage.session.get(null),r=Object.keys(s).filter(e=>e.startsWith("logs:"));await chrome.storage.session.remove(r)};export{p as S,v as a,u as b,d as c,T as d,_ as e,B as f,Y as g,R as h,h as i,D as l,E as r};
