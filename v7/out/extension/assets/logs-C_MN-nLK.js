import"./modulepreload-polyfill-B5Qt9EMX.js";import{j as e,r as c,a as m}from"./client-BVdrxQBY.js";import{g as p,c as b}from"./logs-DOAcrpKK.js";const h=({onCopy:s,onExport:r,onClear:t,autoScroll:n,onToggleAutoScroll:o,disableClear:a=!1})=>e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:s,className:"px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded text-sm transition-colors",children:"Copy to Clipboard"}),e.jsx("button",{onClick:r,className:"px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded text-sm transition-colors",children:"Export as File"}),e.jsx("button",{onClick:t,disabled:a,className:`px-3 py-1 rounded text-sm transition-colors ${a?"bg-red-100/50 text-red-400 cursor-not-allowed":"bg-red-100 hover:bg-red-200 text-red-700"}`,children:"Clear Logs"}),e.jsxs("button",{onClick:o,className:`px-3 py-1 rounded text-sm transition-colors ${n?"bg-blue-100 text-blue-700 hover:bg-blue-200":"bg-gray-100 hover:bg-gray-200"}`,children:["Auto-scroll: ",n?"ON":"OFF"]})]}),j=({logs:s})=>e.jsx("div",{id:"logs-container",className:"font-mono text-xs bg-gray-50 border border-gray-200 rounded-lg p-4 h-[600px] overflow-auto",children:s.length===0?e.jsx("div",{className:"text-gray-500",children:"No logs yet. Run tests to see logs appear here in real-time."}):s.map((r,t)=>e.jsx("div",{className:"hover:bg-gray-100 px-2 py-1 rounded",children:r},t))}),f=({logsCount:s})=>{const r=chrome.runtime.getManifest().version;return e.jsxs("div",{className:"border-b pb-4",children:[e.jsxs("h1",{className:"text-2xl font-semibold flex items-center gap-2",children:["Live Test Logs",e.jsxs("span",{className:"text-sm text-gray-500",children:["v",r]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-600",children:[e.jsx("span",{children:"All tabs (last 3000 entries)"}),e.jsxs("span",{children:[s," entries"]})]})]})},g=(s,r)=>{if(!s)return null;const t=s.match(new RegExp(`${r}=([^\\s]+)`));if(!t||!t[1])return null;const n=t[1].replace(/^"(.*)"$/,"$1"),o=Number(n);return Number.isNaN(o)?null:o},y=({logs:s})=>{const r=[...s].reverse().find(l=>l.includes("rules:start")),t=[...s].reverse().find(l=>l.includes("rules:done"));if(!r)return null;const n=g(r,"total"),o=g(r,"enabled"),a=g(t,"total");return e.jsxs("div",{className:"bg-slate-50 border border-slate-200 rounded-md px-4 py-2 text-sm text-slate-600 flex gap-4 flex-wrap",children:[e.jsxs("span",{children:["Rules total: ",n??"n/a"]}),e.jsxs("span",{children:["Enabled: ",o??"n/a"]}),e.jsxs("span",{children:["Results logged: ",a??"n/a"]})]})},v=()=>{const[s,r]=c.useState([]);return c.useEffect(()=>{let t=!1;const n=()=>p().then(a=>{t||r(a)});n();const o=(a,l)=>{l==="session"&&Object.keys(a).some(i=>i.startsWith("logs:"))&&n()};return chrome.storage.onChanged.addListener(o),()=>{t=!0,chrome.storage.onChanged.removeListener(o)}},[]),s},N=(s,r)=>{c.useEffect(()=>{if(!s)return;const t=document.getElementById("logs-container");t&&(t.scrollTop=t.scrollHeight)},[s,r])},L=({tabId:s})=>{const r=v(),[t,n]=c.useState(!0),o=r;N(t,o);const a=()=>navigator.clipboard.writeText(o.join(`
`)),l=()=>{const x=new Blob([o.join(`
`)],{type:"text/plain"}),u=URL.createObjectURL(x),d=document.createElement("a");d.href=u,d.download=`logs-${new Date().toISOString()}.txt`,d.click(),URL.revokeObjectURL(u)},i=async()=>{await b()};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(f,{tabId:s,logsCount:o.length}),e.jsx(y,{logs:o}),e.jsx(h,{onCopy:a,onExport:l,onClear:i,autoScroll:t,onToggleAutoScroll:()=>n(!t),disableClear:!1}),e.jsx(j,{logs:o})]})},w=()=>{const[s,r]=c.useState(null);return c.useEffect(()=>{const n=new URLSearchParams(window.location.search).get("tabId");if(n!==null){const o=Number(n);r(Number.isNaN(o)?null:o);return}chrome.storage.session.get("lastActiveTab").then(o=>{const a=o.lastActiveTab;typeof a=="number"&&r(a)}).catch(()=>{})},[]),e.jsx("div",{className:"min-h-screen bg-white",children:e.jsx("div",{className:"max-w-6xl mx-auto p-4 sm:p-6",children:e.jsx(L,{tabId:s})})})};m.createRoot(document.getElementById("app")).render(e.jsx(c.StrictMode,{children:e.jsx(w,{})}));
