import"./modulepreload-polyfill-B5Qt9EMX.js";import{j as t,r as p,c as b}from"./client-BVdrxQBY.js";import{R as j,r as y,L as w,o as R,a as u}from"./openUrlInCurrentTab-BKHxsGDD.js";import{r as v}from"./runMeta-CidP79Hf.js";const N=({type:o,items:e})=>t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[t.jsxs("h2",{className:"text-lg font-semibold",children:[o.toUpperCase()," (",e.length,")"]}),t.jsx("div",{className:"space-y-2",children:e.map(s=>t.jsx(j,{result:s,index:s.index,defaultExpanded:!0},s.index))})]}),$=()=>{const[o,e]=p.useState([]),[s,r]=p.useState(null),[n,c]=p.useState(!0);return p.useEffect(()=>{const a=new URLSearchParams(window.location.search),l=a.get("tabId"),i=a.get("index");if(!l){c(!1);return}(async()=>{try{const d=parseInt(l,10),[g,f]=await Promise.all([y(d),v(d).catch(()=>null)]);e(g),r(f),i&&setTimeout(()=>{const m=document.getElementById(`result-${i}`);m==null||m.scrollIntoView({behavior:"smooth",block:"center"})},100)}catch(d){console.error("Failed to load report data:",d)}finally{c(!1)}})()},[]),{results:o,runMeta:s,loading:n}},x=o=>o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),k=(o,e)=>{const s=e.map(a=>`<div class="row"><span class="k">${x(a.label)}</span><span class="t ${a.type}">${x(a.type)}</span><div class="m">${a.message}</div></div>`).join(""),r=e.reduce((a,l)=>(a[l.type]=(a[l.type]||0)+1,a),{}),n=`ok ${r.ok||0} · warn ${r.warn||0} · error ${r.error||0} · info ${r.info||0}`;return`<!doctype html><meta charset="utf-8"><title>Live Test Report</title><style>.row{border:1px solid #e5e7eb;margin:8px 0;padding:8px;border-radius:6px}.k{font:600 12px system-ui;color:#475569;margin-right:8px}.t{font:600 12px}.t.ok{color:#16a34a}.t.warn{color:#ca8a04}.t.error{color:#dc2626}.m{font:14px system-ui;margin-top:6px;word-break:break-word}</style><h1>Live Test Report</h1><p>URL: ${x(o)}</p><p>${n}</p>${s}`},L=(o,e,s)=>{const r=new Blob([e],{type:s}),n=document.createElement("a");n.href=URL.createObjectURL(r),n.download=o,n.click(),setTimeout(()=>URL.revokeObjectURL(n.href),0)},I=({url:o,results:e})=>{const s=async(c,a,l)=>{try{await navigator.clipboard.writeText(a)}catch(i){console.warn(`[report] clipboard copy failed for ${c}`,i),L(`live-test.${l==="application/json"?"json":"html"}`,a,l)}},r=()=>s("json",JSON.stringify(e,null,2),"application/json"),n=()=>s("html",k(o,e),"text/html");return t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{className:"border px-2 py-1 text-xs rounded",onClick:r,children:"Copy JSON"}),t.jsx("button",{className:"border px-2 py-1 text-xs rounded",onClick:n,children:"Copy HTML"})]})},E=o=>{const e=o.reduce((s,r,n)=>{const c=r.type||"info";return s[c]||(s[c]=[]),s[c].push({...r,index:n}),s},{});return Object.entries(e).sort(([s],[r])=>{const n=u[s]??999,c=u[r]??999;return n-c})},S=()=>{const{results:o,runMeta:e,loading:s}=$(),r=E(o),n=chrome.runtime.getManifest().version;return s?t.jsx("div",{className:"min-h-screen bg-white",children:t.jsx("div",{className:"max-w-6xl mx-auto p-4 sm:p-6",children:t.jsx("h1",{className:"text-2xl font-semibold",children:"Loading Report..."})})}):o.length?t.jsx("div",{className:"min-h-screen bg-white",children:t.jsxs("div",{className:"max-w-6xl mx-auto",children:[t.jsx(w,{url:(e==null?void 0:e.url)||"",runId:e==null?void 0:e.runId,ranAt:e==null?void 0:e.ranAt,version:n,onOpenUrl:R,secondaryActions:t.jsxs(t.Fragment,{children:[t.jsxs("span",{className:"text-gray-600",children:[o.length," results"]}),t.jsx(I,{url:(e==null?void 0:e.url)||"",results:o})]})}),t.jsx("div",{className:"p-4 sm:p-6 space-y-6",children:r.map(([c,a])=>t.jsx(N,{type:c,items:a},c))})]})}):t.jsx("div",{className:"min-h-screen bg-white",children:t.jsxs("div",{className:"max-w-6xl mx-auto p-4 sm:p-6",children:[t.jsx("h1",{className:"text-2xl font-semibold mb-2",children:"No Results Found"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Run a test from the extension to see results here."})]})})},h=document.getElementById("root");if(!h)throw new Error("Root element not found");b(h).render(t.jsx(S,{}));
