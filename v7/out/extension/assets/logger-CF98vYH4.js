var u=Object.defineProperty;var g=(n,t,e)=>t in n?u(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var c=(n,t,e)=>g(n,typeof t!="symbol"?t+"":t,e);import{l as d}from"./logs-DOAcrpKK.js";function f(n){if(n===null)return"null";if(n===void 0)return"undefined";if(typeof n=="string"){if(n.includes("<")&&n.includes(">")){const t=n.length>500?n.substring(0,500)+"...[truncated]":n;return JSON.stringify(t)}return JSON.stringify(n)}if(typeof n=="number"||typeof n=="boolean")return n.toString();if(Array.isArray(n)||typeof n=="object")try{return JSON.stringify(n)}catch{return Array.isArray(n)?`[${n.length}]`:`{${Object.keys(n).length}}`}return String(n)}function h(n){return Object.entries(n).map(([t,e])=>`${t}=${f(e)}`).join(" ")}function s(n,t,e,r){const o=new Date().toISOString(),i=r?" "+h(r):"";return`[${o}] ${n}:${t}:${e}${i}`}class a{static setTabId(t){this.currentTabId=t}static setContext(t){this.contextName=t}static async getTabId(){var t;if(this.currentTabId!==null)return this.currentTabId;if(typeof chrome<"u"&&chrome.tabs){const e=await chrome.tabs.query({active:!0,currentWindow:!0});if((t=e[0])!=null&&t.id)return e[0].id}return null}static async log(t,e,r){const o=s(this.contextName,t,e,r);if(typeof chrome<"u"&&chrome.runtime){const i=await this.getTabId();await chrome.runtime.sendMessage({channel:"log",tabId:i,message:o})}}static logSync(t,e,r){const o=s(this.contextName,t,e,r);typeof chrome<"u"&&chrome.runtime&&chrome.runtime.sendMessage({channel:"log",tabId:this.currentTabId,message:o})}static async logDirect(t,e,r,o){if(t===null)throw console.error(`[Logger.logDirect] FAILED: tabId is null for [${e}] ${r}`,o),new Error(`Logger.logDirect called with null tabId - this should never happen! Context: ${this.contextName}`);const i=s(this.contextName,e,r,o);await d(t,i)}static logDirectSend(t,e,r,o){if(t===null)throw console.error(`[Logger.logDirectSend] FAILED: tabId is null for [${e}] ${r}`,o),new Error(`Logger.logDirectSend called with null tabId - this should never happen! Context: ${this.contextName}`);const i=s(this.contextName,e,r,o);typeof chrome<"u"&&chrome.runtime?chrome.runtime.sendMessage({channel:"log",tabId:t,message:i}):console.warn(`[Logger.logDirectSend] TEST CONTEXT: Would send log [${e}] ${r}`,o)}static startTimer(t){const e=performance.now(),r=Math.random().toString(36).slice(2,9);return this.logSync("perf","start",{operation:t,id:r}),async()=>{const o=(performance.now()-e).toFixed(2);await this.log("perf","end",{operation:t,id:r,duration:`${o}ms`})}}static async logError(t,e,r){const o=e instanceof Error?e.message:String(e),i=e instanceof Error?e.stack:void 0;await this.log("error",t,{error:o,stack:(i==null?void 0:i.split(`
`)[0])||"no-stack",...r})}static async logWarn(t,e,r){await this.log("warn",t,{message:e,...r})}}c(a,"currentTabId",null),c(a,"contextName","unknown");export{a as L};
