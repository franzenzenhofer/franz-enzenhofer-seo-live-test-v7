const d=t=>t?t.outerHTML:"",h=t=>!t||t.length===0?"":Array.from(t).map(e=>e.outerHTML).join(`
`),i=(t,e=100)=>{if(!t)return"";const n=t.trim();return n.length<=e?n:n.substring(0,e)+"..."},m=t=>{if(!t)return"";const e=[];let n=t;const s=1;for(;n&&n.nodeType===s;){let o=n.nodeName.toLowerCase();if(n.id){o+=`#${n.id}`,e.unshift(o);break}if(n.className){const r=n.className.trim().split(/\s+/).filter(l=>l);r.length>0&&(o+=`.${r.join(".")}`)}const a=n.parentElement;if(a){const r=Array.from(a.children).filter(l=>l.nodeName===n.nodeName);if(r.length>1){const l=r.indexOf(n)+1;o+=`:nth-of-type(${l})`}}e.unshift(o),n=a}return e.join(" > ")},I={id:"head-title",name:"Title Present",enabled:!0,run:async t=>{var l;const e=t.doc.querySelector("head > title"),n=((l=e==null?void 0:e.textContent)==null?void 0:l.trim())||"",s=n.length>0,o=d(e),a=i(o),r=m(e);return{label:"HEAD",message:s?`SEO-<title>: ${n}`:"No title-tag found in head.",type:s?"ok":"error",what:"static",priority:s?1e3:0,name:"title",details:{sourceHtml:o,snippet:a,domPath:r}}}},j={id:"head-meta-description",name:"Meta Description",enabled:!0,run:async t=>{const e=t.doc.querySelectorAll('meta[name="description"]');if(e.length===0)return{label:"BODY",message:"No meta description found.",type:"error",what:"static",priority:0,name:"metaDescription"};if(e.length>1){const a=Array.from(e).map(r=>d(r)).join(`
`);return{label:"HEAD",message:"Multiple meta description found.",type:"error",what:"static",priority:0,name:"metaDescription",details:{sourceHtml:a,snippet:i(a)}}}const n=e[0],s=n.content||"",o=d(n);return{label:"HEAD",message:`Meta description: ${s}`,type:"info",what:"static",priority:760,name:"metaDescription",details:{sourceHtml:o,snippet:i(o),domPath:m(n)}}}},U={id:"head-canonical",name:"Canonical Link",enabled:!0,run:async t=>{const e=t.doc.querySelector('link[rel="canonical"]');if(!e||!e.href)return{label:"HEAD",message:"No canonical link found.",type:"error",what:"static",name:"canonical"};const n=d(e);return{label:"HEAD",message:`Canonical: ${e.href}`,type:"info",what:"static",name:"canonical",details:{sourceHtml:n,snippet:i(n),domPath:m(e)}}}},G=t=>t?t>=200&&t<300?{t:"ok",m:`HTTP ${t}`}:t>=300&&t<400?{t:"info",m:`Redirect ${t}`}:t>=400?{t:"error",m:`HTTP Error ${t}`}:{t:"info",m:`HTTP ${t}`}:{t:"warn",m:"Status unknown"},B={id:"http-status",name:"HTTP Status",enabled:!0,run:async t=>{const e=G(t.status);return{label:"HTTP",message:e.m,type:e.t,name:"httpStatus",details:{httpHeaders:t.headers||{}}}}},_=t=>{try{const e=new URL(t);return e.protocol!=="http:"&&e.protocol!=="https:"?(console.error(`[robotsTxt] Invalid protocol blocked: ${e.protocol} from ${t}`),""):`${e.origin}/robots.txt`}catch(e){return console.error(`[robotsTxt] Invalid URL: ${t}`,e),""}},V={id:"robots-exists",name:"robots.txt Exists",enabled:!0,run:async t=>{const e=_(t.url);if(!e)return{label:"ROBOTS",message:"Invalid or unsupported URL",type:"info",name:"robotsTxt"};try{const n=await fetch(e,{method:"GET"});if(!n.ok)return{label:"ROBOTS",message:`robots.txt not reachable (${n.status})`,type:"warn",name:"robotsTxt"};const s=await n.text();return{label:"ROBOTS",message:/\n\s*sitemap\s*:/i.test(`
${s}`)?"robots.txt with Sitemap":"robots.txt present",type:"info",name:"robotsTxt",details:{robotsTxt:s}}}catch(n){return{label:"ROBOTS",message:String(n),type:"warn",name:"robotsTxt"}}}},z=t=>t.toLowerCase().split(",").map(e=>e.trim()),J={id:"head-robots-meta",name:"Robots Meta",enabled:!0,run:async t=>{const e=t.doc.querySelector('meta[name="robots"]');if(!e||!e.content)return{label:"HEAD",message:"No robots meta tag.",type:"info",what:"static",priority:610,name:"robotsMeta"};const n=z(e.content),s=n.includes("noindex"),o=n.includes("nofollow"),a="robots: "+e.content,r=s||o?"warn":"info",l=d(e);return{label:"HEAD",message:a,type:r,what:"static",priority:610,name:"robotsMeta",details:{sourceHtml:l,snippet:i(l),domPath:m(e)}}}},K={id:"head-hreflang",name:"Hreflang Links",enabled:!0,run:async t=>{const e=t.doc.querySelectorAll('link[rel="alternate"][hreflang]');if(e.length===0)return{name:"Hreflang Links",label:"HEAD",message:"No hreflang links found.",type:"info",what:"static"};const n=h(e);return{name:"Hreflang Links",label:"HEAD",message:`Hreflang links: ${e.length}`,type:"info",what:"static",details:{sourceHtml:n,snippet:i(n)}}}},Y={id:"head:hreflang-multipage",name:"Hreflang multipage sanity",enabled:!0,async run(t){const e=Array.from(t.doc.querySelectorAll('link[rel="alternate"][hreflang]'));if(!e.length)return{name:"Hreflang multipage sanity",label:"HEAD",message:"No hreflang links",type:"info"};const n=h(e),s=e.map(r=>(r.getAttribute("hreflang")||"").toLowerCase()),o=s.length!==new Set(s).size,a=s.includes("x-default");return o?{name:"Hreflang multipage sanity",label:"HEAD",message:"Duplicate hreflang entries",type:"warn",details:{sourceHtml:n,snippet:i(n)}}:{name:"Hreflang multipage sanity",label:"HEAD",message:a?"hreflang set with x-default":"Consider adding x-default",type:a?"ok":"info",details:{sourceHtml:n,snippet:i(n)}}}},F={id:"og-title",name:"Open Graph Title",enabled:!0,run:async t=>{const e=t.doc.querySelector('meta[property="og:title"]');if(!e||!e.content)return{label:"HEAD",message:"No og:title meta.",type:"info",what:"static",name:"ogTitle"};const n=d(e);return{label:"HEAD",message:`OG title: ${e.content}`,type:"info",what:"static",name:"ogTitle",details:{sourceHtml:n,snippet:i(n),domPath:m(e)}}}},W={id:"og:description",name:"Open Graph Description",enabled:!0,async run(t){var o;const e=t.doc.querySelector('meta[property="og:description"], meta[name="og:description"]');if(!e)return{label:"OG",message:"Missing og:description",type:"warn",name:"ogDescription"};const n=((o=e.getAttribute("content"))==null?void 0:o.trim())||"";if(!n)return{label:"OG",message:"Empty og:description",type:"warn",name:"ogDescription"};const s=d(e);return{label:"OG",message:`og:description: ${n}`,type:"info",name:"ogDescription",details:{sourceHtml:s,snippet:i(s),domPath:m(e)}}}},X={id:"og:url",name:"Open Graph URL",enabled:!0,async run(t){var o;const e=t.doc.querySelector('meta[property="og:url"], meta[name="og:url"]');if(!e)return{label:"OG",message:"Missing og:url",type:"warn",name:"ogUrl"};const n=((o=e.getAttribute("content"))==null?void 0:o.trim())||"",s=d(e);return n?{label:"OG",message:`og:url: ${n}`,type:"info",name:"ogUrl",details:{sourceHtml:s,snippet:i(s),domPath:m(e)}}:{label:"OG",message:"Empty og:url",type:"warn",name:"ogUrl",details:{sourceHtml:s,snippet:i(s),domPath:m(e)}}}},Q={id:"og:image",name:"Open Graph Image",enabled:!0,async run(t){const e=t.doc.querySelector('meta[property="og:image"], meta[name="og:image"]');if(!e)return{label:"OG",message:"Missing og:image",type:"warn",name:"ogImage"};const n=(e.getAttribute("content")||"").trim(),s=/^https?:\/\//i.test(n),o=d(e);return s?{label:"OG",message:`og:image: ${n}`,type:"info",name:"ogImage",details:{sourceHtml:o,snippet:i(o),domPath:m(e)}}:{label:"OG",message:"og:image not absolute",type:"warn",name:"ogImage",details:{sourceHtml:o,snippet:i(o),domPath:m(e)}}}},Z=t=>t.trim().length,ee={id:"head:title-length",name:"Title Length",enabled:!0,async run(t){const e=t.doc.querySelector("head > title"),n=(e==null?void 0:e.textContent)||"",s=Z(n),o=d(e);return s?{label:"HEAD",message:s<10?"Title too short":s>70?"Title too long":`Title length OK (${s})`,type:s<10||s>70?"warn":"ok",name:"titleLength",details:e?{sourceHtml:o,snippet:i(o),domPath:m(e)}:void 0}:{label:"HEAD",message:"Missing <title>",type:"error",name:"titleLength"}}},te={id:"head:meta-viewport",name:"Meta Viewport",enabled:!0,async run(t){const e=t.doc.querySelector('meta[name="viewport"]');if(!e)return{name:"Meta Viewport",label:"HEAD",message:"Missing meta viewport",type:"warn"};const n=d(e),s=(e.getAttribute("content")||"").toLowerCase(),o=s.includes("width=device-width")&&(s.includes("initial-scale=1")||s.includes("initial-scale=1.0"));return{name:"Meta Viewport",label:"HEAD",message:o?"Viewport OK":"Viewport content may be suboptimal",type:o?"ok":"warn",details:{sourceHtml:n,snippet:i(n),domPath:m(e)}}}},ne={id:"head:brand-in-title",name:"Brand in Title",enabled:!0,async run(t,e){const n=e.globals.variables||{},s=String(n.brand||"").trim();if(!s)return{name:"Brand in Title",label:"HEAD",message:"Brand not configured",type:"info"};const o=t.doc.querySelector("head > title"),a=(o==null?void 0:o.textContent)||"",r=o?d(o):"",l=a.toLowerCase().includes(s.toLowerCase());return{name:"Brand in Title",label:"HEAD",message:l?"Title contains brand":"Title missing brand",type:l?"ok":"warn",details:o?{sourceHtml:r,snippet:i(r),domPath:m(o)}:void 0}}},se={id:"head:shortlink",name:"Shortlink Header",enabled:!0,async run(t){const e=t.doc.querySelector('link[rel="shortlink"]');if(e){const n=d(e);return{label:"HEAD",message:`shortlink: ${e.getAttribute("href")||""}`,type:"info",name:"shortlink",details:{sourceHtml:n,snippet:i(n),domPath:m(e)}}}return{label:"HEAD",message:"No shortlink",type:"info",name:"shortlink"}}},oe={id:"head:amphtml",name:"AMP HTML Link",enabled:!0,async run(t){const e=t.doc.querySelector('link[rel="amphtml"]');if(e){const n=d(e);return{name:"AMP HTML Link",label:"HEAD",message:`amphtml: ${e.getAttribute("href")||""}`,type:"info",details:{sourceHtml:n,snippet:i(n),domPath:m(e)}}}return{name:"AMP HTML Link",label:"HEAD",message:"No amphtml link",type:"info"}}},ae={id:"dom:ldjson",name:"LD+JSON presence",enabled:!0,async run(t){const e=Array.from(t.doc.querySelectorAll('script[type="application/ld+json"]')),n=e.length,s=h(e);return n?{label:"DOM",message:`ld+json blocks: ${n}`,type:"info",name:"ldjson",details:{sourceHtml:s,snippet:i(s)}}:{label:"DOM",message:"No ld+json",type:"info",name:"ldjson"}}},re={id:"head:meta-keywords",name:"Meta Keywords",enabled:!0,async run(t){const e=t.doc.querySelector('meta[name="keywords"]');if(e){const n=d(e);return{name:"Meta Keywords",label:"HEAD",message:"Meta keywords present (deprecated)",type:"info",details:{sourceHtml:n,snippet:i(n),domPath:m(e)}}}return{name:"Meta Keywords",label:"HEAD",message:"No meta keywords",type:"ok"}}},le={id:"head:meta-charset",name:"Meta charset",enabled:!0,async run(t){const e=t.doc.querySelector("meta[charset]");if(e){const n=d(e);return{name:"Meta charset",label:"HEAD",message:`charset=${e.getAttribute("charset")||""}`,type:"info",details:{sourceHtml:n,snippet:i(n),domPath:m(e)}}}return{name:"Meta charset",label:"HEAD",message:"Missing meta[charset]",type:"warn"}}},ie={id:"head:canonical-absolute",name:"Canonical absolute URL",enabled:!0,async run(t){const e=t.doc.querySelector('link[rel="canonical"]'),n=(e==null?void 0:e.getAttribute("href"))||"";if(!n)return{name:"Canonical absolute URL",label:"HEAD",message:"No canonical link",type:"info"};const s=e?d(e):"";try{new URL(n,t.url);const o=n.startsWith("http");return{name:"Canonical absolute URL",label:"HEAD",message:o?"Canonical absolute":"Canonical is relative",type:o?"ok":"warn",details:e?{sourceHtml:s,snippet:i(s),domPath:m(e)}:void 0}}catch{return{name:"Canonical absolute URL",label:"HEAD",message:"Invalid canonical URL",type:"warn",details:e?{sourceHtml:s,snippet:i(s),domPath:m(e)}:void 0}}}},O=t=>{try{const e=new URL(t);return e.hash="",e.search="",e.pathname=e.pathname.replace(/\/index\.(html?)$/i,"/").replace(/([^/])$/,"$1"),e.pathname!=="/"&&e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),e.hostname=e.hostname.toLowerCase(),e.toString()}catch{return t}},ce={id:"head:canonical-self",name:"Canonical self-referential",enabled:!0,async run(t){const e=t.doc.querySelector('link[rel="canonical"]'),n=(e==null?void 0:e.getAttribute("href"))||"";if(!n)return{name:"Canonical self-referential",label:"HEAD",message:"No canonical",type:"info"};const s=e?d(e):"",o=O(t.url),a=O(new URL(n,t.url).toString()),r=o===a;return{name:"Canonical self-referential",label:"HEAD",message:r?"Canonical matches URL":`Canonical differs (${a})`,type:r?"ok":"info",details:e?{sourceHtml:s,snippet:i(s),domPath:m(e)}:void 0}}},me={id:"head:twitter-card",name:"Twitter Card",enabled:!0,async run(t){const e=t.doc.querySelector('meta[name="twitter:card"]');if(e){const n=d(e);return{label:"HEAD",message:`twitter:card=${e.getAttribute("content")||""}`,type:"info",name:"twitterCard",details:{sourceHtml:n,snippet:i(n),domPath:m(e)}}}return{label:"HEAD",message:"No twitter:card",type:"info",name:"twitterCard"}}},de={id:"head:robots-noindex",name:"Meta robots noindex",enabled:!0,async run(t){const e=t.doc.querySelector('meta[name="robots"]');if(!e)return{name:"Meta robots noindex",label:"HEAD",message:"No robots meta",type:"info"};const n=d(e),s=(e.getAttribute("content")||"").toLowerCase(),o=/\bnoindex\b/.test(s);return{name:"Meta robots noindex",label:"HEAD",message:o?"robots: noindex":"robots: indexable",type:o?"warn":"ok",details:{sourceHtml:n,snippet:i(n),domPath:m(e)}}}},ue=t=>((t==null?void 0:t["content-encoding"])||"").toLowerCase(),pe={id:"http:gzip",name:"Gzip/Brotli",enabled:!0,async run(t){const e=ue(t.headers),n=e.includes("br")||e.includes("gzip");return e?{label:"HTTP",message:n?`Compressed (${e})`:`Not compressed (${e})`,type:n?"ok":"warn",name:"gzip",details:{httpHeaders:t.headers||{}}}:{label:"HTTP",message:"No content-encoding header",type:"warn",name:"gzip",details:{httpHeaders:t.headers||{}}}}},ge={id:"http:hsts",name:"Strict-Transport-Security",enabled:!0,async run(t){var n;const e=(n=t.headers)==null?void 0:n["strict-transport-security"];return e?{label:"HTTP",message:`HSTS: ${e}`,type:"info",name:"hsts",details:{httpHeaders:t.headers||{}}}:{label:"HTTP",message:"Missing HSTS header",type:"warn",name:"hsts",details:{httpHeaders:t.headers||{}}}}},he={id:"http:link-header",name:"Link Header",enabled:!0,async run(t){var n;const e=(n=t.headers)==null?void 0:n.link;return{label:"HTTP",message:e?`Link: ${e}`:"No Link header",type:"info",name:"linkHeader",details:{httpHeaders:t.headers||{}}}}},be={id:"http:x-robots",name:"X-Robots-Tag",enabled:!0,async run(t){var n;const e=(n=t.headers)==null?void 0:n["x-robots-tag"];return{label:"HTTP",message:e?`X-Robots-Tag: ${e}`:"No X-Robots-Tag",type:"info",name:"xRobots",details:{httpHeaders:t.headers||{}}}}},ye=(t,e)=>((t==null?void 0:t[e])||(t==null?void 0:t[e.toLowerCase()])||"").toLowerCase(),fe={id:"http:x-cache",name:"X-Cache hit/miss",enabled:!0,async run(t){const e=ye(t.headers,"x-cache");return e?{label:"HTTP",message:`X-Cache: ${e.includes("hit")?"HIT":e.includes("miss")?"MISS":e}`,type:"info",name:"xCache",details:{httpHeaders:t.headers||{}}}:{label:"HTTP",message:"No X-Cache header",type:"info",name:"xCache",details:{httpHeaders:t.headers||{}}}}},we={id:"http:vary-user-agent",name:"Vary: User-Agent",enabled:!0,async run(t){var n;return{label:"HTTP",message:(((n=t.headers)==null?void 0:n.vary)||"").toLowerCase().includes("user-agent")?"Vary includes User-Agent":"Vary does not include User-Agent",type:"info",name:"varyUserAgent",details:{httpHeaders:t.headers||{}}}}},Se=(t,e)=>(t==null?void 0:t[e.toLowerCase()])||"",Ae={id:"http:has-header",name:"HTTP has header (configurable)",enabled:!0,async run(t,e){const n=e.globals.variables||{},s=String(n.http_has_header||"").trim();if(!s)return{label:"HTTP",message:"No header configured (set variables.http_has_header)",type:"info",name:"hasHeader",details:{httpHeaders:t.headers||{}}};const o=s.split(",").map(r=>r.trim().toLowerCase()).filter(Boolean),a=o.filter(r=>!Se(t.headers,r));return{label:"HTTP",message:a.length?`Missing headers: ${a.join(", ")}`:`All headers present: ${o.join(", ")}`,type:a.length?"warn":"ok",name:"hasHeader",details:{httpHeaders:t.headers||{}}}}},ke=t=>/\b(404|not found|seite nicht gefunden|pagina no encontrada)\b/i.test(t),Re={id:"http:soft-404",name:"Soft 404 check",enabled:!0,async run(t){const e=t.status;if(!e||e>=400)return{label:"HTTP",message:"Status not 2xx, skipping soft 404",type:"info",name:"soft404",details:{httpHeaders:t.headers||{}}};const n=ke(t.html);return{label:"HTTP",message:n?"Possible soft 404: page looks not found but status is 2xx":"Not a soft 404",type:n?"warn":"ok",name:"soft404",details:{httpHeaders:t.headers||{}}}}},He={id:"head:canonical-redirects",name:"Canonical Redirects",enabled:!0,async run(t){const e=t.doc.querySelector('link[rel="canonical"]'),n=e==null?void 0:e.getAttribute("href");if(!n)return{name:"Canonical Redirects",label:"HEAD",message:"No canonical link found.",type:"error"};const s=e?d(e):"";try{const o=await fetch(n,{method:"HEAD",redirect:"manual"}),a=o.headers.get("location"),r=o.status>=300&&o.status<400;return{name:"Canonical Redirects",label:"HEAD",message:r?`Canonical redirects to ${a||"(no location)"}`:"Canonical does not redirect",type:r?"warn":"ok",details:e?{sourceHtml:s,snippet:i(s),domPath:m(e)}:void 0}}catch(o){return{name:"Canonical Redirects",label:"HEAD",message:`Canonical check failed: ${String(o)}`,type:"warn",details:e?{sourceHtml:s,snippet:i(s),domPath:m(e)}:void 0}}}},Ce={id:"body:h1",name:"H1 Present",enabled:!0,async run(t){const e=t.doc.querySelectorAll("h1"),n=e.length;if(n===0)return{label:"BODY",message:"No <h1> found",type:"warn",name:"h1"};const s=h(e),o=e[0]||null;return n>1?{label:"BODY",message:`Multiple <h1> found (${n})`,type:"warn",name:"h1",details:{sourceHtml:s,snippet:i(s)}}:{label:"BODY",message:"<h1> OK",type:"ok",name:"h1",details:{sourceHtml:s,snippet:i(s),domPath:m(o)}}}},ve={id:"body:images-layout",name:"Images missing dimensions",enabled:!0,async run(t){const e=Array.from(t.doc.querySelectorAll("img")),n=[];for(const s of e)(!s.getAttribute("width")||!s.getAttribute("height"))&&n.push(s);if(n.length>0){const s=h(n);return{label:"BODY",message:`${n.length} images missing width/height`,type:"warn",name:"imagesLayout",details:{sourceHtml:s,snippet:i(s)}}}return{label:"BODY",message:"All images have dimensions",type:"ok",name:"imagesLayout"}}},De={id:"body:images-lazy",name:"Images lazy-loading",enabled:!0,async run(t){const e=Array.from(t.doc.querySelectorAll("img")),n=[];for(const s of e)s.getAttribute("loading")||n.push(s);if(n.length>0){const s=h(n);return{label:"BODY",message:`${n.length} images without loading attribute`,type:"info",name:"imagesLazy",details:{sourceHtml:s,snippet:i(s)}}}return{label:"BODY",message:"Images have loading attribute",type:"ok",name:"imagesLazy"}}},Pe={id:"body:nofollow",name:"Nofollow Links",enabled:!0,async run(t){const e=Array.from(t.doc.querySelectorAll('a[rel~="nofollow"]'));if(e.length>0){const n=h(e);return{label:"BODY",message:`${e.length} nofollow links`,type:"info",name:"nofollow",details:{sourceHtml:n,snippet:i(n)}}}return{label:"BODY",message:"No rel=nofollow links",type:"ok",name:"nofollow"}}},Te={id:"a11y:linked-images-alt",name:"Linked Images need alt",enabled:!0,async run(t){const e=t.doc.querySelectorAll("a img"),n=[];if(e.forEach(o=>{(o.getAttribute("alt")||"").trim()||n.push(o)}),n.length>0){const o=h(n);return{label:"A11Y",message:`${n.length} linked images missing alt`,type:"warn",name:"linkedImagesAlt",details:{sourceHtml:o,snippet:i(o)}}}const s=h(e);return{label:"A11Y",message:"Linked images have alt",type:"ok",name:"linkedImagesAlt",details:{sourceHtml:s,snippet:i(s)}}}},Oe=(t,e)=>{try{const n=new URL(t),s=new URL(e,t);return n.host===s.host}catch{return!1}},xe={id:"body:internal-links",name:"Internal links count",enabled:!0,async run(t){const e=Array.from(t.doc.querySelectorAll("a[href]")),n=[],s=[];for(const a of e)Oe(t.url,a.getAttribute("href")||"")?n.push(a):s.push(a);const o=h(e);return{label:"BODY",message:`Links: internal ${n.length}, external ${s.length}`,type:"info",name:"internalLinks",details:{sourceHtml:o,snippet:i(o)}}}},Le={id:"body:parameterized-links",name:"Links with query params",enabled:!0,async run(t){const e=Array.from(t.doc.querySelectorAll("a[href]")),n=[];for(const o of e)(o.getAttribute("href")||"").includes("?")&&n.push(o);const s=h(n);return{label:"BODY",message:`Links with parameters: ${n.length}`,type:"info",name:"parameterizedLinks",details:{sourceHtml:s,snippet:i(s)}}}},$e={id:"body:unsecure-input",name:"Unsecure input over HTTP",enabled:!0,async run(t){let e="";try{e=new URL(t.url).protocol}catch{}if(e!=="http:")return{label:"BODY",message:"Page not HTTP",type:"info",name:"unsecureInput"};const n=Array.from(t.doc.querySelectorAll('input[type="password"]'));if(n.length>0){const s=h(n);return{label:"BODY",message:"Password input over HTTP",type:"warn",name:"unsecureInput",details:{sourceHtml:s,snippet:i(s)}}}return{label:"BODY",message:"No password inputs over HTTP",type:"ok",name:"unsecureInput"}}},Ee={id:"head:rel-alternate-media",name:"rel=alternate media",enabled:!0,async run(t){const e=t.doc.querySelectorAll('link[rel="alternate"][media]'),n=e.length;if(n){const s=h(e);return{name:"rel=alternate media",label:"HEAD",message:`rel=alternate[media] links: ${n}`,type:"info",details:{sourceHtml:s,snippet:i(s)}}}return{name:"rel=alternate media",label:"HEAD",message:"No rel=alternate media links",type:"info"}}},Ne=t=>{const e=t.querySelector('link[rel="amphtml"]');return{element:e,href:(e==null?void 0:e.getAttribute("href"))||""}},Me=t=>{try{const e=new URL(t),n=e.host+e.pathname;return e.protocol==="https:"?`https://cdn.ampproject.org/c/s/${n}`:`https://cdn.ampproject.org/c/${n}`}catch{return""}},qe={id:"google:amp-cache-url",name:"AMP Cache URL",enabled:!0,async run(t){const e=Ne(t.doc);if(!e.href)return{label:"HEAD",message:"No amphtml link",type:"info",name:"ampCacheUrl"};const n=Me(e.href),s=d(e.element);return n?{label:"HEAD",message:`AMP Cache: ${n}`,type:"info",name:"ampCacheUrl",details:{sourceHtml:s,snippet:i(s),domPath:m(e.element)}}:{label:"HEAD",message:"AMP Cache not derivable",type:"info",name:"ampCacheUrl",details:{sourceHtml:s,snippet:i(s),domPath:m(e.element)}}}},Ie=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),je=(t,e)=>{const n=e.trim();if(!n)return!1;let s="^"+Ie(n).replace(/\*/g,".*");return!s.endsWith("$")&&!n.endsWith("*")&&(s+=".*"),new RegExp(s).test(t)},Ue=(t,e)=>{const n=e.toLowerCase();let s="",o=!1;for(let a of t)a=a.toLowerCase().trim(),a&&(n.includes(a)||a==="*")&&a.length>=s.length&&(s=a,o=!0);return o};function E(t,e,n="Googlebot"){let s=-1,o=!1,a=!1,r=!1;const l=(()=>{try{const k=new URL(e);return k.pathname+k.search}catch{return"/"}})();let c=[],u="";for(const k of t.split(`
`)){let y=k.trim();if(!y||y.startsWith("#"))continue;y.includes("#")&&(y=y.slice(0,y.indexOf("#")).trim());const R=y.indexOf(":");if(R===-1)continue;const w=y.slice(0,R).trim().toLowerCase(),H=y.slice(R+1).trim();if(w==="user-agent"){c=u==="user-agent"?[...c,H]:[H],u="user-agent";continue}if(w==="disallow"||w==="allow"||w==="noindex"){if(u=w,!c.length||!Ue(c,n)||!je(l,H))continue;const C=H.trim().length;C>s&&(s=C,o=a=!1),C===s&&(w==="allow"&&(o=!0),w==="disallow"&&(a=!0),w==="noindex"&&(r=!0))}}const p=s>=0&&a;return{allowed:!p||o,disallowed:p,noindex:r}}const Ge=(t,e)=>{try{return new URL(t).host===new URL(e).host}catch{return!1}},Be={id:"robots:blocked-resources",name:"robots.txt blocked resources",enabled:!0,async run(t){const e=t.resources||[];if(!e.length)return{label:"ROBOTS",message:"No resource requests captured",type:"info",name:"robotsBlockedResources"};const n=new URL(t.url),s=await fetch(`${n.origin}/robots.txt`).catch(()=>null);if(!s||!s.ok)return{label:"ROBOTS",message:"robots.txt not reachable for blocked check",type:"info",name:"robotsBlockedResources"};const o=await s.text(),a="Googlebot";let r=0;for(const l of e){if(!Ge(t.url,l))continue;const c=E(o,l,a),u=!!c.allowed,p=!!c.disallowed;(!u||p)&&r++}return{label:"ROBOTS",message:r?`${r} resources disallowed by robots.txt`:"No blocked resources",type:r?"warn":"ok",name:"robotsBlockedResources",details:{robotsTxt:o}}}},x=t=>t.length>1&&t.endsWith("/"),_e={id:"url:trailing-slash",name:"URL trailing slash consistency",enabled:!0,async run(t){var s;let e="/";try{e=new URL(t.url).pathname}catch{}const n=((s=t.doc.querySelector('link[rel="canonical"]'))==null?void 0:s.getAttribute("href"))||"";if(!n)return{label:"URL",message:"No canonical to compare",type:"info",name:"trailingSlash"};try{const o=new URL(n,t.url).pathname,a=x(e)===x(o);return{label:"URL",message:a?"Trailing slash consistent":"Trailing slash inconsistency with canonical",type:a?"ok":"warn",name:"trailingSlash"}}catch{return{label:"URL",message:"Invalid canonical URL",type:"warn",name:"trailingSlash"}}}},N=t=>{let e=1;const n=t.childNodes||[];for(let s=0;s<n.length;s++)e+=N(n[s]);return e},Ve={id:"dom:node-count",name:"DOM node count",enabled:!0,async run(t){const e=N(t.doc.documentElement);return{label:"DOM",message:`Node count: ${e}`,type:"info",name:"nodeCount",details:{nodeCount:e}}}},M=t=>{let e=1;for(let n=0;n<t.children.length;n++)e=Math.max(e,1+M(t.children[n]));return e},ze={id:"dom:node-depth",name:"DOM node depth",enabled:!0,async run(t){const e=M(t.doc.documentElement);return{label:"DOM",message:`Max depth: ${e}`,type:"info",name:"nodeDepth",details:{maxDepth:e}}}},Je=t=>{var e;return(((e=t.body)==null?void 0:e.innerText)||"").replace(/\s+/g," ").trim().length},Ke={id:"dom:client-side-rendering",name:"Client-side rendering heuristic",enabled:!0,async run(t){const e=Je(t.doc),n=Array.from(t.doc.querySelectorAll("script[src]")),s=n.length,o=t.doc.querySelectorAll("script:not([async]):not([defer])[src]").length,a=e<40&&(s>5||o>0),r=h(n);return a?{label:"DOM",message:"Possible client-side rendering (very low text, many scripts)",type:"info",name:"clientSideRendering",details:{sourceHtml:r,snippet:i(r),textLength:e,scriptCount:s,heavyScriptCount:o}}:{label:"DOM",message:"Server-rendered content likely present",type:"info",name:"clientSideRendering"}}},Ye={id:"dom:html-lang",name:"HTML lang attribute",enabled:!0,async run(t){const e=t.doc.documentElement,n=(e.getAttribute("lang")||"").trim(),s=`<html${e.attributes.length?" ":""}${Array.from(e.attributes).map(o=>`${o.name}="${o.value}"`).join(" ")}>`;return n?{label:"DOM",message:`lang=${n}`,type:"info",name:"htmlLang",details:{sourceHtml:s,snippet:i(s),domPath:m(e)}}:{label:"DOM",message:"Missing html[lang]",type:"warn",name:"htmlLang"}}},Fe={id:"speed:link-preload",name:"rel=preload links",enabled:!0,async run(t){const e=t.doc.querySelectorAll('link[rel="preload"]'),n=e.length,s=n?h(e):"";return{label:"SPEED",message:n?`preload links: ${n}`:"No preload links",type:"info",name:"linkPreload",details:n?{sourceHtml:s,snippet:i(s)}:void 0}}},We={id:"speed:blocking-scripts",name:"Blocking scripts in head",enabled:!0,async run(t){const e=t.doc.querySelectorAll("head script[src]:not([async]):not([defer])"),n=e.length,s=n?h(e):"";return{label:"SPEED",message:n?`Blocking scripts in head: ${n}`:"No blocking head scripts",type:n?"warn":"ok",name:"blockingScripts",details:n?{sourceHtml:s,snippet:i(s)}:void 0}}},Xe={id:"speed:preconnect",name:"rel=preconnect",enabled:!0,async run(t){const e=t.doc.querySelectorAll('link[rel="preconnect"]'),n=e.length,s=n?h(e):"";return{label:"SPEED",message:n?`preconnect links: ${n}`:"No preconnect links",type:"info",name:"preconnect",details:n?{sourceHtml:s,snippet:i(s)}:void 0}}},Qe={id:"speed:dns-prefetch",name:"rel=dns-prefetch",enabled:!0,async run(t){const e=t.doc.querySelectorAll('link[rel="dns-prefetch"]'),n=e.length,s=n?h(e):"";return{label:"SPEED",message:n?`dns-prefetch links: ${n}`:"No dns-prefetch links",type:"info",name:"dnsPrefetch",details:n?{sourceHtml:s,snippet:i(s)}:void 0}}},Ze={id:"google:is-connected",name:"Google auth connected",enabled:!0,async run(t,e){return e.globals.googleApiAccessToken||null?{label:"GOOGLE",message:"Google token present",type:"ok",name:"isConnected"}:{label:"GOOGLE",message:"No Google token",type:"info",name:"isConnected"}}},et={id:"debug:page-summary",name:"Page summary (debug)",enabled:!1,async run(t){const e=t.doc.querySelector("title"),n=((e==null?void 0:e.textContent)||"").trim(),s=t.headers&&Object.keys(t.headers).length||0,o=(t.resources||[]).length,a=d(e);return{label:"DEBUG",message:`Title: ${n} · headers: ${s} · resources: ${o}`,type:"info",name:"pageSummary",details:{sourceHtml:a,snippet:i(a),domPath:m(e),headers:t.headers,resourceCount:o}}}},tt={id:"head:meta-googlebot",name:"Meta Googlebot",enabled:!0,async run(t){const e=t.doc.querySelector('meta[name="googlebot"]');if(e){const n=d(e);return{name:"Meta Googlebot",label:"HEAD",message:`googlebot: ${e.getAttribute("content")||""}`,type:"info",details:{sourceHtml:n,snippet:i(n),domPath:m(e)}}}return{name:"Meta Googlebot",label:"HEAD",message:"No googlebot meta",type:"info"}}},v=new Map,nt=t=>{try{const e=new URL(t);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}},P=t=>nt(t)?(v.has(t)||v.set(t,fetch(t).then(e=>e.ok?e.text():null).catch(()=>null)),v.get(t)):(console.error(`[fetchTextOnce] Invalid URL blocked: ${t}`),Promise.resolve(null)),st={id:"robots:googlebot-url-check",name:"Googlebot URL allowed",enabled:!0,async run(t){let e="";try{e=new URL(t.url).origin}catch{return{label:"ROBOTS",message:"Invalid URL",type:"info",name:"googlebotUrlCheck"}}const n=await P(`${e}/robots.txt`);if(!n)return{label:"ROBOTS",message:"robots.txt not reachable",type:"info",name:"googlebotUrlCheck"};const o=!!E(n,t.url,"Googlebot").allowed;return{label:"ROBOTS",message:o?"Googlebot is allowed":"Googlebot is disallowed",type:o?"ok":"warn",name:"googlebotUrlCheck",details:{robotsTxt:n}}}},ot={id:"robots:sitemap-reference",name:"robots.txt Sitemap reference",enabled:!0,async run(t){let e="";try{const o=new URL(t.url);if(o.protocol!=="http:"&&o.protocol!=="https:")return{label:"ROBOTS",message:`Skipped: ${o.protocol} URL`,type:"info",name:"robotsSitemapReference"};e=o.origin}catch{return{label:"ROBOTS",message:"Invalid URL",type:"info",name:"robotsSitemapReference"}}const n=await P(`${e}/robots.txt`);if(!n)return{label:"ROBOTS",message:"robots.txt not reachable",type:"info",name:"robotsSitemapReference"};const s=/\n\s*sitemap\s*:\s*\S+/i.test(`
${n}`);return{label:"ROBOTS",message:s?"Sitemap reference present":"No Sitemap reference",type:s?"ok":"warn",name:"robotsSitemapReference",details:{robotsTxt:n}}}},at={id:"robots:complexity",name:"robots.txt complexity",enabled:!0,async run(t){let e="";try{e=new URL(t.url).origin}catch{return{label:"ROBOTS",message:"Invalid URL",type:"info",name:"robotsComplexity"}}const n=await P(`${e}/robots.txt`);if(!n)return{label:"ROBOTS",message:"robots.txt not reachable",type:"info",name:"robotsComplexity"};const s=n.split(/\r?\n/),o=s.filter(l=>/^\s*disallow\s*:/i.test(l)).length,a=s.filter(l=>/^\s*allow\s*:/i.test(l)).length,r=s.filter(l=>/^\s*sitemap\s*:/i.test(l)).length;return{label:"ROBOTS",message:`Rules: Disallow ${o}, Allow ${a}, Sitemaps ${r}`,type:"info",name:"robotsComplexity",details:{robotsTxt:n}}}},rt={id:"a11y:linked-images-alt-no-text",name:"Linked images without alt and text",enabled:!0,async run(t){const e=[],n=Array.from(t.doc.querySelectorAll("a"));for(const s of n){const o=s.querySelector("img");if(!o)continue;const a=(o.getAttribute("alt")||"").trim(),r=(s.textContent||"").trim();!a&&!r&&e.push(s)}if(e.length>0){const s=e.map(o=>d(o)).join(`
`);return{label:"A11Y",message:`${e.length} linked images without alt and text`,type:"warn",name:"linkedImagesAltNoText",details:{sourceHtml:s,snippet:i(s)}}}return{label:"A11Y",message:"Linked images have alt or text",type:"ok",name:"linkedImagesAltNoText"}}},q=new Map,lt=(t,e)=>`psi:${e}:${t}`,L=()=>Date.now(),it=async t=>q.get(t)||null,ct=async(t,e)=>(q.set(t,e),!0),T=async(t,e,n)=>{const s=lt(t,e),o=await it(s);if(o&&L()-o.ts<5*6e4)return o.data;const a=`https://www.googleapis.com/pagespeedonline/v5/runPagespeed?strategy=${e}&url=${encodeURIComponent(t)}&key=${encodeURIComponent(n)}`,r=await fetch(a);if(!r.ok)throw new Error(`PSI ${r.status}`);const l=await r.json();return await ct(s,{ts:L(),data:l}),l},mt={id:"psi:mobile",name:"PSI v5 Mobile score",enabled:!1,async run(t,e){var r,l,c;const n=e.globals.variables||{},s=String(n.google_page_speed_insights_key||"").trim();if(!s)return{label:"PSI",message:"No PSI key set",type:"info",name:"googleRule"};const o=await T(t.url,"mobile",s);return{label:"PSI",message:`Mobile performance: ${Math.round((((c=(l=(r=o.lighthouseResult)==null?void 0:r.categories)==null?void 0:l.performance)==null?void 0:c.score)||0)*100)}`,type:"info",name:"googleRule"}}},dt={id:"psi:desktop",name:"PSI v5 Desktop score",enabled:!1,async run(t,e){var r,l,c;const n=e.globals.variables||{},s=String(n.google_page_speed_insights_key||"").trim();if(!s)return{label:"PSI",message:"No PSI key set",type:"info",name:"googleRule"};const o=await T(t.url,"desktop",s);return{label:"PSI",message:`Desktop performance: ${Math.round((((c=(l=(r=o.lighthouseResult)==null?void 0:r.categories)==null?void 0:l.performance)==null?void 0:c.score)||0)*100)}`,type:"info",name:"googleRule"}}},ut=t=>{const e=t.globals.variables||{};return String(e.google_page_speed_insights_key||"").trim()},pt={id:"psi:mobile-fcp-tbt",name:"PSI v5 Mobile FCP/TBT",enabled:!1,async run(t,e){var c,u,p;const n=ut(e);if(!n)return{label:"PSI",message:"No PSI key set",type:"info",name:"googleRule"};const o=((c=(await T(t.url,"mobile",n)).lighthouseResult)==null?void 0:c.audits)||{},a=(u=o["first-contentful-paint"])==null?void 0:u.numericValue,r=(p=o["total-blocking-time"])==null?void 0:p.numericValue;return{label:"PSI",message:[typeof a=="number"?`FCP ${Math.round(a)}ms`:null,typeof r=="number"?`TBT ${Math.round(r)}ms`:null].filter(Boolean).join(", ")||"Metrics unavailable",type:"info",name:"googleRule"}}},gt={id:"gsc:property-available",name:"GSC webproperty available",enabled:!1,async run(t,e){const n=e.globals.googleApiAccessToken||null;if(!n)return{label:"GSC",message:"No Google token",type:"info",name:"googleRule"};const s=new URL(t.url).origin,o=await fetch("https://www.googleapis.com/webmasters/v3/sites",{headers:{Authorization:`Bearer ${n}`}});return o.ok?((await o.json()).siteEntry||[]).some(l=>(l.siteUrl||"").includes(s))?{label:"GSC",message:"Property available",type:"ok",name:"googleRule"}:{label:"GSC",message:"Property not available",type:"warn",name:"googleRule"}:{label:"GSC",message:`GSC error ${o.status}`,type:"warn",name:"googleRule"}}},ht={id:"gsc:is-indexed",name:"GSC is indexed (via impressions)",enabled:!1,async run(t,e){const n=e.globals.googleApiAccessToken||null,s=e.globals.variables||{};if(!n)return{label:"GSC",message:"No Google token",type:"info",name:"googleRule"};const o=String(s.gsc_site_url||"");if(!o)return{label:"GSC",message:"Set variables.gsc_site_url",type:"info",name:"googleRule"};const a={startDate:"2020-01-01",endDate:"2099-12-31",dimensions:["page"],dimensionFilterGroups:[{groupType:"and",filters:[{dimension:"page",operator:"equals",expression:t.url}]}]},r=await fetch(`https://www.googleapis.com/webmasters/v3/sites/${encodeURIComponent(o)}/searchAnalytics/query`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"content-type":"application/json"},body:JSON.stringify(a)});if(!r.ok)return{label:"GSC",message:`GSC query error ${r.status}`,type:"warn",name:"googleRule"};const c=((await r.json()).rows||[]).reduce((u,p)=>u+(p.impressions||0),0);return c>0?{label:"GSC",message:`Indexed (impressions ${c})`,type:"ok",name:"googleRule"}:{label:"GSC",message:"No impressions (might not be indexed)",type:"warn",name:"googleRule"}}},bt={id:"gsc:top-queries-of-page",name:"GSC Top queries of page",enabled:!1,async run(t,e){const n=e.globals.googleApiAccessToken||null,s=e.globals.variables||{};if(!n)return{label:"GSC",message:"No Google token",type:"info",name:"googleRule"};const o=String(s.gsc_site_url||"");if(!o)return{label:"GSC",message:"Set variables.gsc_site_url",type:"info",name:"googleRule"};const a={startDate:"2020-01-01",endDate:"2099-12-31",dimensions:["query","page"],dimensionFilterGroups:[{groupType:"and",filters:[{dimension:"page",operator:"equals",expression:t.url}]}],rowLimit:5},r=await fetch(`https://www.googleapis.com/webmasters/v3/sites/${encodeURIComponent(o)}/searchAnalytics/query`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"content-type":"application/json"},body:JSON.stringify(a)});return r.ok?{label:"GSC",message:`Top queries: ${((await r.json()).rows||[]).map(u=>`${(u.keys||[])[0]||""} (${u.impressions||0})`).join(", ")||"none"}`,type:"info",name:"googleRule"}:{label:"GSC",message:`GSC query error ${r.status}`,type:"warn",name:"googleRule"}}},yt={id:"gsc:page-worldwide",name:"GSC page worldwide analytics",enabled:!1,async run(t,e){const n=e.globals.googleApiAccessToken||null,s=e.globals.variables||{};if(!n)return{label:"GSC",message:"No Google token",type:"info",name:"googleRule"};const o=String(s.gsc_site_url||"");if(!o)return{label:"GSC",message:"Set variables.gsc_site_url",type:"info",name:"googleRule"};const a={startDate:"2020-01-01",endDate:"2099-12-31",dimensions:["page"]},r=await fetch(`https://www.googleapis.com/webmasters/v3/sites/${encodeURIComponent(o)}/searchAnalytics/query`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"content-type":"application/json"},body:JSON.stringify(a)});if(!r.ok)return{label:"GSC",message:`GSC query error ${r.status}`,type:"warn",name:"googleRule"};const c=((await r.json()).rows||[]).find(A=>(A.keys||[])[0]===t.url),u=(c==null?void 0:c.impressions)||0,p=(c==null?void 0:c.clicks)||0;return{label:"GSC",message:`Impressions ${u}, Clicks ${p}`,type:"info",name:"googleRule"}}},ft={id:"gsc:directory-worldwide",name:"GSC directory worldwide analytics",enabled:!1,async run(t,e){const n=e.globals.googleApiAccessToken||null,s=e.globals.variables||{};if(!n)return{label:"GSC",message:"No Google token",type:"info",name:"googleRule"};const o=String(s.gsc_site_url||"");if(!o)return{label:"GSC",message:"Set variables.gsc_site_url",type:"info",name:"googleRule"};const a=t.url.replace(/\/?[^/]*$/,"/"),r={startDate:"2020-01-01",endDate:"2099-12-31",dimensions:["page"],dimensionFilterGroups:[{groupType:"and",filters:[{dimension:"page",operator:"contains",expression:a}]}],rowLimit:10},l=await fetch(`https://www.googleapis.com/webmasters/v3/sites/${encodeURIComponent(o)}/searchAnalytics/query`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"content-type":"application/json"},body:JSON.stringify(r)});return l.ok?{label:"GSC",message:`Directory impressions ${((await l.json()).rows||[]).reduce((p,A)=>p+(A.impressions||0),0)}`,type:"info",name:"googleRule"}:{label:"GSC",message:`GSC query error ${l.status}`,type:"warn",name:"googleRule"}}},wt={id:"url:history-state-update",name:"History state update detected",enabled:!0,async run(t,e){const n=e.globals.events||[],s=n.some(a=>a&&a.t==="nav:history"),o=n.some(a=>a&&a.t==="nav:commit");return{label:"URL",message:s&&!o?"History state update (SPA navigation) observed":"No SPA-only history update detected",type:"info",name:"historyStateUpdate"}}},St=t=>((t==null?void 0:t["x-robots-tag"])||"").toLowerCase(),At={id:"http:unavailable-after",name:"X-Robots unavailable_after",enabled:!0,async run(t){const e=St(t.headers),n=/unavailable_after\s*:\s*\S+/.test(e);return{label:"HTTP",message:n?`unavailable_after set (${e})`:"No unavailable_after",type:n?"warn":"ok",name:"unavailableAfter",details:{httpHeaders:t.headers||{}}}}},kt={id:"http:common-mobile-setup",name:"Common mobile setup",enabled:!0,async run(t){const e=t.doc.querySelector('meta[name="viewport"]'),n=t.doc.querySelector('link[rel~="apple-touch-icon"]'),s=!!e,o=!!n,a=s,r=d(e);return{label:"HEAD",message:a?`Viewport present${o?", apple-touch-icon present":""}`:"Missing meta viewport",type:a?"info":"warn",name:"commonMobileSetup",details:e?{sourceHtml:r,snippet:i(r),domPath:m(e)}:void 0}}},Rt={id:"http:cache-delivery",name:"Delivered from cache (Age)",enabled:!0,async run(t){var n;const e=Number(((n=t.headers)==null?void 0:n.age)||"0");return{label:"HTTP",message:e>0?`Age: ${e} (from cache)`:"No cache Age header",type:"info",name:"cacheDelivery",details:{httpHeaders:t.headers||{}}}}},Ht=["content-security-policy","x-content-type-options","referrer-policy","permissions-policy","cross-origin-resource-policy"],Ct={id:"http:security-headers",name:"Security headers presence",enabled:!0,async run(t){const e=t.headers||{},n=Ht.filter(s=>!e[s]);return{label:"HTTP",message:n.length?`Missing security headers: ${n.join(", ")}`:"Security headers present",type:"info",name:"securityHeaders",details:{httpHeaders:e}}}},vt={id:"http:https-scheme",name:"HTTPS Scheme",enabled:!0,async run(t){try{if(new URL(t.url).protocol==="https:")return{label:"HTTP",message:"HTTPS in use",type:"ok",name:"httpsScheme",details:{httpHeaders:t.headers||{}}}}catch{}return{label:"HTTP",message:"Not using HTTPS",type:"warn",name:"httpsScheme",details:{httpHeaders:t.headers||{}}}}},Dt={id:"http:h2-advertised",name:"HTTP/2 Advertised (Alt-Svc)",enabled:!0,async run(t){var n;const e=(((n=t.headers)==null?void 0:n["alt-svc"])||"").toLowerCase();return{label:"HTTP",message:/\bh2\b|h2=/.test(e)?"Alt-Svc advertises HTTP/2":"HTTP/2 not advertised",type:"info",name:"http2Advertised",details:{httpHeaders:t.headers||{}}}}},Pt={id:"http:h3-advertised",name:"HTTP/3 Advertised (Alt-Svc)",enabled:!0,async run(t){var n;const e=(((n=t.headers)==null?void 0:n["alt-svc"])||"").toLowerCase();return{label:"HTTP",message:/\bh3\b|h3-/.test(e)?"Alt-Svc advertises HTTP/3":"HTTP/3 not advertised",type:"info",name:"http3Advertised",details:{httpHeaders:t.headers||{}}}}},Tt={id:"http:alt-svc-other",name:"Alt-Svc other protocols",enabled:!0,async run(t){var r;const e=(((r=t.headers)==null?void 0:r["alt-svc"])||"").toLowerCase(),n=/(h2|h3)/g,s=!!e,o=e.replace(n,""),a=/quic|spdy|http\/1\.1/.test(o);return{label:"HTTP",message:s&&a?`Alt-Svc other protocols: ${e}`:"No other Alt-Svc protocols",type:"info",name:"altSvcOtherProtocols",details:{httpHeaders:t.headers||{}}}}},Ot=t=>{var e;return(((e=t.body)==null?void 0:e.innerText)||"").toLowerCase().replace(/[^a-z0-9\s]/g," ").replace(/\s+/g," ").trim()},xt=t=>{const e=new Map;for(const n of t.split(" "))n.length>=4&&e.set(n,(e.get(n)||0)+1);return[...e.entries()].sort((n,s)=>s[1]-n[1]).slice(0,5)},Lt={id:"dom:top-words",name:"Top words",enabled:!0,async run(t){const e=Ot(t.doc);if(!e)return{label:"DOM",message:"No text",type:"info",name:"topWords"};const n=xt(e);return{label:"DOM",message:`Top words: ${n.map(([o,a])=>`${o}(${a})`).join(", ")}`,type:"info",name:"topWords",details:{topWords:Object.fromEntries(n)}}}},$t={id:"head:canonical-chain",name:"Canonical redirect chain",enabled:!0,async run(t){const e=t.doc.querySelector('link[rel="canonical"]'),n=(e==null?void 0:e.getAttribute("href"))||"";if(!n)return{name:"Canonical redirect chain",label:"HEAD",message:"No canonical link",type:"info"};const s=e?d(e):"";let a=new URL(n,t.url).toString(),r=0;for(let c=0;c<5;c++){const u=await fetch(a,{method:"HEAD",redirect:"manual"});if(u.status>=300&&u.status<400){const p=u.headers.get("location");if(!p)break;a=new URL(p,a).toString(),r++}else break}const l=r>0;return{name:"Canonical redirect chain",label:"HEAD",message:l?`Canonical chain length ${r}`:"Canonical no redirects",type:l?r>3?"error":"warn":"ok",details:e?{sourceHtml:s,snippet:i(s),domPath:m(e)}:void 0}}},D=t=>{if(!t)return[];if(Array.isArray(t))return t.flatMap(D);if(typeof t=="object"){const e=t;return Array.isArray(e["@graph"])?D(e["@graph"]):[e]}return[]},f=t=>{const e=[];return t.querySelectorAll('script[type="application/ld+json"]').forEach(n=>{try{e.push(...D(JSON.parse(n.textContent||"null")))}catch{}}),e},Et=t=>{const e=t["@type"];return e?(Array.isArray(e)?e:[e]).map(n=>String(n).toLowerCase()):[]},b=(t,e)=>t.filter(n=>Et(n).some(s=>s.includes(e.toLowerCase()))),S=(t,e)=>{let n=t;for(const s of e.split(".")){if(n===null||typeof n!="object")return;n=n[s]}return n},g=t=>{const e="https://developers.google.com/search/docs/appearance/structured-data";return{article:`${e}/article`,product:`${e}/product`,faq:`${e}/faqpage`,howto:`${e}/how-to`,recipe:`${e}/recipe`,event:`${e}/event`,jobposting:`${e}/job-posting`,video:`${e}/video`,breadcrumb:`${e}/breadcrumb`,organization:`${e}/logo`,localbusiness:`${e}/local-business`,website:`${e}/sitelinks-searchbox`,review:`${e}/review-snippet`}[t.toLowerCase()]||e},Nt={id:"schema:article:present",name:"Schema Article present",enabled:!0,async run(t){const e=t.doc.querySelectorAll('script[type="application/ld+json"]'),n=f(t.doc);if(![...b(n,"article"),...b(n,"newsarticle"),...b(n,"blogposting")].length)return{label:"SCHEMA",message:"No Article/NewsArticle JSON‑LD",type:"info",name:"schemaArticlePresent"};const o=Array.from(e).find(r=>{var l,c;return((l=r.textContent)==null?void 0:l.includes("Article"))||((c=r.textContent)==null?void 0:c.includes("BlogPosting"))})||null,a=d(o);return{label:"SCHEMA",message:`Article JSON‑LD found · Docs: ${g("article")}`,type:"ok",name:"schemaArticlePresent",details:o?{sourceHtml:a,snippet:i(a),domPath:m(o)}:void 0}}},Mt=(t,e)=>{let n=t;for(const s of e.split(".")){if(n===null||typeof n!="object")return!1;n=n[s]}return!!n},qt=(t,e)=>e.filter(n=>!Mt(t,n)),It={id:"schema:article:required",name:"Schema Article required fields",enabled:!0,async run(t){const e=t.doc.querySelectorAll('script[type="application/ld+json"]'),n=f(t.doc),s=[...b(n,"article"),...b(n,"newsarticle"),...b(n,"blogposting")];if(!s.length)return{label:"SCHEMA",message:"No Article JSON‑LD",type:"info",name:"schemaArticleRequired"};const o=s[0],a=["headline"],r=!!S(o,"datePublished")||!!S(o,"dateModified"),l=qt(o,a);r||l.push("datePublished|dateModified"),S(o,"image")||l.push("image");const c=S(o,"author");(typeof c=="string"?c:S(c,"name"))||l.push("author.name");const p=Array.from(e).find(k=>{var y,R;return((y=k.textContent)==null?void 0:y.includes("Article"))||((R=k.textContent)==null?void 0:R.includes("BlogPosting"))})||null,A=d(p);return{label:"SCHEMA",message:l.length?`Article missing: ${l.join(", ")} · Docs: ${g("article")}`:`Article required OK · Docs: ${g("article")}`,type:l.length?"warn":"ok",name:"schemaArticleRequired",details:p?{sourceHtml:A,snippet:i(A),domPath:m(p)}:void 0}}},jt={id:"schema:breadcrumb",name:"Schema BreadcrumbList",enabled:!0,async run(t){const e=t.doc.querySelectorAll('script[type="application/ld+json"]'),n=b(f(t.doc),"breadcrumblist")[0];if(!n)return{label:"SCHEMA",message:"No BreadcrumbList JSON‑LD",type:"info",name:"schemaBreadcrumb"};const o=(n.itemListElement||[]).length>=2,a=Array.from(e).find(l=>{var c;return(c=l.textContent)==null?void 0:c.includes("BreadcrumbList")})||null,r=d(a);return{label:"SCHEMA",message:o?`Breadcrumb OK · Docs: ${g("breadcrumb")}`:`Breadcrumb needs ≥2 items · Docs: ${g("breadcrumb")}`,type:o?"ok":"warn",name:"schemaBreadcrumb",details:a?{sourceHtml:r,snippet:i(r),domPath:m(a)}:void 0}}},Ut={id:"schema:event",name:"Schema Event",enabled:!0,async run(t){const e=t.doc.querySelectorAll('script[type="application/ld+json"]'),n=b(f(t.doc),"event")[0];if(!n)return{label:"SCHEMA",message:"No Event JSON‑LD",type:"info",name:"schemaEvent"};const s=!!n.name&&!!n.startDate&&!!n.location,o=Array.from(e).find(r=>{var l;return(l=r.textContent)==null?void 0:l.includes("Event")})||null,a=d(o);return{label:"SCHEMA",message:s?`Event OK · Docs: ${g("event")}`:`Event missing fields · Docs: ${g("event")}`,type:s?"ok":"warn",name:"schemaEvent",details:o?{sourceHtml:a,snippet:i(a),domPath:m(o)}:void 0}}},Gt={id:"schema:faq",name:"Schema FAQPage",enabled:!0,async run(t){const e=t.doc.querySelectorAll('script[type="application/ld+json"]'),n=b(f(t.doc),"faqpage")[0];if(!n)return{label:"SCHEMA",message:"No FAQPage JSON‑LD",type:"info",name:"schemaFaq"};const o=(n.mainEntity||[]||[]).some(l=>l&&String(l["@type"]||"").toLowerCase().includes("question")&&!!l.acceptedAnswer),a=Array.from(e).find(l=>{var c;return(c=l.textContent)==null?void 0:c.includes("FAQPage")})||null,r=d(a);return{label:"SCHEMA",message:o?`FAQPage OK · Docs: ${g("faq")}`:`FAQPage invalid (questions/answers) · Docs: ${g("faq")}`,type:o?"ok":"warn",name:"schemaFaq",details:a?{sourceHtml:r,snippet:i(r),domPath:m(a)}:void 0}}},Bt={id:"schema:howto",name:"Schema HowTo",enabled:!0,async run(t){const e=t.doc.querySelectorAll('script[type="application/ld+json"]'),n=b(f(t.doc),"howto")[0];if(!n)return{label:"SCHEMA",message:"No HowTo JSON‑LD",type:"info",name:"schemaHowTo"};const s=!!n.name&&Array.isArray(n.step),o=Array.from(e).find(r=>{var l;return(l=r.textContent)==null?void 0:l.includes("HowTo")})||null,a=d(o);return{label:"SCHEMA",message:s?`HowTo OK · Docs: ${g("howto")}`:`HowTo missing name/step · Docs: ${g("howto")}`,type:s?"ok":"warn",name:"schemaHowTo",details:o?{sourceHtml:a,snippet:i(a),domPath:m(o)}:void 0}}},_t={id:"schema:jobposting",name:"Schema JobPosting",enabled:!0,async run(t){const e=t.doc.querySelectorAll('script[type="application/ld+json"]'),n=b(f(t.doc),"jobposting")[0];if(!n)return{label:"SCHEMA",message:"No JobPosting JSON‑LD",type:"info",name:"schemaJobPosting"};const s=!!n.title&&!!n.datePosted&&!!n.hiringOrganization,o=Array.from(e).find(r=>{var l;return(l=r.textContent)==null?void 0:l.includes("JobPosting")})||null,a=d(o);return{label:"SCHEMA",message:s?`JobPosting OK · Docs: ${g("jobposting")}`:`JobPosting missing fields · Docs: ${g("jobposting")}`,type:s?"ok":"warn",name:"schemaJobPosting",details:o?{sourceHtml:a,snippet:i(a),domPath:m(o)}:void 0}}},Vt={id:"schema:organization",name:"Schema Organization/LocalBusiness",enabled:!0,async run(t){const e=t.doc.querySelectorAll('script[type="application/ld+json"]'),n=f(t.doc),s=b(n,"organization")[0]||b(n,"localbusiness")[0];if(!s)return{label:"SCHEMA",message:"No Organization/LocalBusiness JSON‑LD",type:"info",name:"schemaOrganization"};const o=!!s.name&&(!!s.logo||!!s.image)&&!!s.url,a=s["@type"]&&String(s["@type"]).toLowerCase().includes("localbusiness")?g("localbusiness"):g("organization"),r=Array.from(e).find(c=>{var u,p;return((u=c.textContent)==null?void 0:u.includes("Organization"))||((p=c.textContent)==null?void 0:p.includes("LocalBusiness"))})||null,l=d(r);return{label:"SCHEMA",message:o?`Org OK · Docs: ${a}`:`Org missing fields · Docs: ${a}`,type:o?"ok":"warn",name:"schemaOrganization",details:r?{sourceHtml:l,snippet:i(l),domPath:m(r)}:void 0}}},zt={id:"schema:product",name:"Schema Product",enabled:!0,async run(t){const e=t.doc.querySelectorAll('script[type="application/ld+json"]'),n=b(f(t.doc),"product")[0];if(!n)return{label:"SCHEMA",message:"No Product JSON‑LD",type:"info",name:"schemaProduct"};const s=[];S(n,"name")||s.push("name");const o=S(n,"offers.price"),a=S(n,"offers.priceCurrency");o||s.push("offers.price"),a||s.push("offers.priceCurrency");const r=Array.from(e).find(c=>{var u;return(u=c.textContent)==null?void 0:u.includes("Product")})||null,l=d(r);return{label:"SCHEMA",message:s.length?`Product missing: ${s.join(", ")} · Docs: ${g("product")}`:`Product OK · Docs: ${g("product")}`,type:s.length?"warn":"ok",name:"schemaProduct",details:r?{sourceHtml:l,snippet:i(l),domPath:m(r)}:void 0}}},Jt={id:"schema:recipe",name:"Schema Recipe",enabled:!0,async run(t){const e=t.doc.querySelectorAll('script[type="application/ld+json"]'),n=b(f(t.doc),"recipe")[0];if(!n)return{label:"SCHEMA",message:"No Recipe JSON‑LD",type:"info",name:"schemaRecipe"};const s=!!n.name&&!!n.image&&(Array.isArray(n.recipeIngredient)||Array.isArray(n.recipeInstructions)),o=Array.from(e).find(r=>{var l;return(l=r.textContent)==null?void 0:l.includes("Recipe")})||null,a=d(o);return{label:"SCHEMA",message:s?`Recipe OK · Docs: ${g("recipe")}`:`Recipe missing fields · Docs: ${g("recipe")}`,type:s?"ok":"warn",name:"schemaRecipe",details:o?{sourceHtml:a,snippet:i(a),domPath:m(o)}:void 0}}},Kt={id:"schema:video",name:"Schema VideoObject",enabled:!0,async run(t){const e=t.doc.querySelectorAll('script[type="application/ld+json"]'),n=b(f(t.doc),"videoobject")[0];if(!n)return{label:"SCHEMA",message:"No VideoObject JSON‑LD",type:"info",name:"schemaVideo"};const s=!!n.name&&!!n.description&&!!n.thumbnailUrl&&!!n.uploadDate,o=Array.from(e).find(r=>{var l;return(l=r.textContent)==null?void 0:l.includes("Video")})||null,a=d(o);return{label:"SCHEMA",message:s?`VideoObject OK · Docs: ${g("video")}`:`VideoObject missing fields · Docs: ${g("video")}`,type:s?"ok":"warn",name:"schemaVideo",details:o?{sourceHtml:a,snippet:i(a),domPath:m(o)}:void 0}}},$=(t,e)=>new RegExp(`\\b${e.replace(/[-]/g,"[-]")}\\b`,"i").test(t),Yt={id:"discover:max-image-preview-large",name:"Discover: max-image-preview:large",enabled:!0,async run(t){var r;const e=t.doc.querySelector('meta[name="robots"]'),n=((e==null?void 0:e.getAttribute("content"))||"").toLowerCase(),s=(((r=t.headers)==null?void 0:r["x-robots-tag"])||"").toLowerCase(),o=$(n,"max-image-preview:large")||$(s,"max-image-preview:large"),a=d(e);return o?{label:"DISCOVER",message:"max-image-preview:large present",type:"ok",name:"maxImagePreviewLarge",details:{sourceHtml:a,snippet:i(a),domPath:m(e),xRobotsTag:s}}:{label:"DISCOVER",message:"Consider max-image-preview:large",type:"warn",name:"maxImagePreviewLarge",details:{sourceHtml:a,snippet:i(a),domPath:m(e)}}}},Ft={id:"discover:twitter-large-card",name:"Discover: Twitter large card",enabled:!0,async run(t){const e=t.doc.querySelector('meta[name="twitter:card"]'),n=((e==null?void 0:e.getAttribute("content"))||"").toLowerCase(),s=d(e);return n==="summary_large_image"?{label:"DISCOVER",message:"twitter:card=summary_large_image",type:"ok",name:"twitterLargeCard",details:{sourceHtml:s,snippet:i(s),domPath:m(e)}}:{label:"DISCOVER",message:"Consider twitter:card=summary_large_image",type:"info",name:"twitterLargeCard",details:{sourceHtml:s,snippet:i(s),domPath:m(e)}}}},Wt=t=>{const e=Array.from(t.querySelectorAll('script[type="application/ld+json"]')),n=[];for(const s of e)try{const o=JSON.parse(s.textContent||"null"),a=Array.isArray(o)?o:[o];for(const r of a){const l=(r&&(r["@type"]||"")).toString().toLowerCase();if(l.includes("article")||l.includes("newsarticle")){n.push(s);break}}}catch{}return{found:n.length>0,scripts:n}},Xt={id:"discover:article-structured-data",name:"Discover: Article structured data",enabled:!0,async run(t){const e=Wt(t.doc),n=h(e.scripts);return e.found?{label:"DISCOVER",message:"Article/NewsArticle structured data present",type:"ok",name:"articleStructuredData",details:{sourceHtml:n,snippet:i(n)}}:{label:"DISCOVER",message:"Add Article structured data",type:"warn",name:"articleStructuredData"}}},Qt=t=>{const e=t.querySelector('meta[property="article:published_time"]')||t.querySelector('meta[name="pubdate"]')||t.querySelector("time[datetime]");if(e){const s=e.getAttribute("content")||(e.tagName==="TIME"?e.getAttribute("datetime"):null)||"";if(s)return{value:s,element:e}}const n=Array.from(t.querySelectorAll('script[type="application/ld+json"]'));for(const s of n)try{const o=JSON.parse(s.textContent||"null"),a=Array.isArray(o)?o:[o];for(const r of a)if(r&&typeof r.datePublished=="string")return{value:r.datePublished,element:s}}catch{}return{value:"",element:null}},Zt={id:"discover:published-time",name:"Discover: Published time",enabled:!0,async run(t){const e=Qt(t.doc),n=d(e.element);return e.value?{label:"DISCOVER",message:`Published: ${e.value}`,type:"info",name:"publishedTime",details:{sourceHtml:n,snippet:i(n),domPath:m(e.element)}}:{label:"DISCOVER",message:"Add published time (meta or LD+JSON)",type:"warn",name:"publishedTime"}}},en=t=>{const e=t.querySelector('meta[name="author"]'),n=((e==null?void 0:e.getAttribute("content"))||"").trim();if(n)return{name:n,element:e};const s=Array.from(t.querySelectorAll('script[type="application/ld+json"]'));for(const o of s)try{const a=JSON.parse(o.textContent||"null"),r=Array.isArray(a)?a:[a];for(const l of r){const c=l&&l.author,u=typeof c=="string"?c:c&&typeof c.name=="string"?c.name:"";if(u)return{name:String(u),element:o}}}catch{}return{name:"",element:null}},tn={id:"discover:author",name:"Discover: Author present",enabled:!0,async run(t){const e=en(t.doc),n=d(e.element);return e.name?{label:"DISCOVER",message:`Author: ${e.name}`,type:"info",name:"authorPresent",details:{sourceHtml:n,snippet:i(n),domPath:m(e.element)}}:{label:"DISCOVER",message:"Add author (meta or LD+JSON)",type:"warn",name:"authorPresent"}}},nn={id:"discover:headline-length",name:"Discover: Headline length",enabled:!0,async run(t){const e=t.doc.querySelector("h1"),s=((e==null?void 0:e.textContent)||"").trim().length;if(!s)return{label:"DISCOVER",message:"No H1 headline",type:"warn",name:"headlineLength"};const o=d(e);return s>=20?{label:"DISCOVER",message:`Headline length OK (${s})`,type:"ok",name:"headlineLength",details:{sourceHtml:o,snippet:i(o),domPath:m(e)}}:{label:"DISCOVER",message:"Headline may be too short",type:"info",name:"headlineLength",details:{sourceHtml:o,snippet:i(o),domPath:m(e)}}}},sn=(t,e)=>{const n=t.querySelector('meta[name="robots"]'),s=((n==null?void 0:n.getAttribute("content"))||"").toLowerCase(),o=((e==null?void 0:e["x-robots-tag"])||"").toLowerCase();return{hasNoindex:/\bnoindex\b/.test(s)||/\bnoindex\b/.test(o),element:n,xRobots:o}},on={id:"discover:indexable",name:"Discover: Indexable",enabled:!0,async run(t){const e=sn(t.doc,t.headers),n=d(e.element);return e.hasNoindex?{label:"DISCOVER",message:"Noindex detected",type:"warn",name:"indexable",details:{sourceHtml:n,snippet:i(n),domPath:m(e.element),xRobotsTag:e.xRobots}}:{label:"DISCOVER",message:"Indexable",type:"ok",name:"indexable"}}},an={id:"discover:canonical-ok",name:"Discover: Canonical present + absolute",enabled:!0,async run(t){const e=t.doc.querySelector('link[rel="canonical"]');if(!e)return{label:"DISCOVER",message:"No canonical link",type:"warn",name:"canonicalOk"};const n=e.getAttribute("href")||"",s=d(e);try{return new URL(n,t.url).toString().startsWith("http")?{label:"DISCOVER",message:"Canonical OK",type:"ok",name:"canonicalOk",details:{sourceHtml:s,snippet:i(s),domPath:m(e)}}:{label:"DISCOVER",message:"Canonical is not absolute",type:"warn",name:"canonicalOk",details:{sourceHtml:s,snippet:i(s),domPath:m(e)}}}catch{return{label:"DISCOVER",message:"Invalid canonical URL",type:"warn",name:"canonicalOk",details:{sourceHtml:s,snippet:i(s),domPath:m(e)}}}}},rn={id:"discover:og-image-large",name:"Discover: Large OG image (metadata)",enabled:!0,async run(t){const e=t.doc.querySelector('meta[property="og:image:width"]'),n=t.doc.querySelector('meta[property="og:image:height"]'),s=t.doc.querySelector('meta[property="og:image"]'),o=parseInt(((e==null?void 0:e.getAttribute("content"))||"").trim(),10),a=parseInt(((n==null?void 0:n.getAttribute("content"))||"").trim(),10);if(!!!s)return{label:"DISCOVER",message:"Missing og:image",type:"warn",name:"ogImageLarge"};const l=o>=1200||a>=1200,c=[s,e,n].filter(Boolean),u=h(c);return l?{label:"DISCOVER",message:"OG image metadata suggests large image",type:"ok",name:"ogImageLarge",details:{sourceHtml:u,snippet:i(u)}}:{label:"DISCOVER",message:"Consider large OG image (>=1200px)",type:"info",name:"ogImageLarge",details:{sourceHtml:u,snippet:i(u)}}}},ln={id:"discover:primary-language",name:"Discover: Primary language set",enabled:!0,async run(t){const e=t.doc.documentElement,n=(e.getAttribute("lang")||"").trim(),s=`<html${e.attributes.length?" ":""}${Array.from(e.attributes).map(o=>`${o.name}="${o.value}"`).join(" ")}>`;return n?{label:"DISCOVER",message:`Primary language: ${n}`,type:"info",name:"primaryLanguage",details:{sourceHtml:s,snippet:i(s),domPath:m(e)}}:{label:"DISCOVER",message:"Set html[lang]",type:"warn",name:"primaryLanguage"}}},cn=[I,j,U,B,V,J,K,Y,F,W,X,Q,ee,te,ne,se,oe,ae,re,le,ie,ce,me,de,pe,ge,he,be,fe,we,Ae,Re,He,Ce,ve,De,Pe,Te,xe,Le,$e,Ee,qe,Be,_e,Ve,ze,Ke,Ye,Fe,We,Xe,Qe,Ze,wt,At,kt,vt,Dt,Pt,Tt,Rt,Ct,Lt,$t,et,tt,st,ot,at,rt,mt,dt,pt,gt,ht,bt,yt,ft,Yt,Ft,Xt,Zt,tn,nn,on,an,rn,ln,Nt,It,jt,Ut,Gt,Bt,_t,Vt,zt,Jt,Kt];export{cn as r};
